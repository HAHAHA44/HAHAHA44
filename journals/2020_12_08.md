---
title: Dec 8th, 2020
---

## NOW [#A] 当 Video dom 在视窗之外，track 会触发 ended 事件 #bug
:PROPERTIES:
:later: 1607409273870
:done: 1607409252035
:todo: 1607409573293
:now: 1607409628882
:id: 5fcf506c-258b-438f-92ad-063071bf3c10
:END:
### https://developer.apple.com/forums/thread/667453
### https://github.com/twilio/twilio-video.js/issues/1281
### https://stackoverflow.com/questions/64975535/safari-a-mediastreamtrack-ended-due-to-a-capture-failure
### DONE 检查代码，和原生实现有什么不同
:PROPERTIES:
:done: 1607419451683
:END:
### Test1(采集): 使用 createCameraVideoTrack 接口创建的 Track 就有这个问题
#### 使用的是这个指令：navigator.mediaDevices.getUserMedia({ "video":{} })
#### replaceMediaStream 用这个方法将 track 放置到 空的 MediaStream 中
###
```js
c1 = document.createElement("div")
c1.style.height = "320px";
c1.style.width = "480px";
v1 = document.createElement("video")
v1.style.width = "100%";
v1.style.height = "100%";
v1.setAttribute("playsInline", "");
v1.controls = false;
document.body.appendChild(c1);
c1.appendChild(v1);
s1 = await navigator.mediaDevices.getUserMedia({ video: {}})
player = new AgoraRTCPlayer({})
ack(s1.getVideoTracks()[0])
player = new AgoraRTCPlayer({})
```
###
### Test2(播放): play 过程有啥问题吗？感觉是 play 的问题
### [#A] **iOS Safari 上 srcObject = x; 到 video.play 之间需要有一定的间隔**
## TODO [#B] getVolumeLevel 接口 使用 getFrequencyData 优化，并测试
:PROPERTIES:
:todo: 1607409271207
:END:
##
##
## #knowledge #Safari Safari 的 AudioContext 最好使用 44100 采样率
### https://github.com/godotengine/godot/issues/36643
## #knowledge #Safari Safari 使用 display：none 来初始化 iFrame的话，这个iFrame将永远不会被显示出来
### https://medium.com/@zachcaceres/dont-use-display-none-to-hide-iframes-in-safari-b51715eb22c4
##
